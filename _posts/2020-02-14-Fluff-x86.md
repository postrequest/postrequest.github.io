---
title: Fluff x86
tags: [rop,rop chain,exploitation,x86,asm]
published: true
description: Solving fluff by rop emporium
toc: true
---

# Introduction
Fluff is the 5th challenge in the <a href="https://ropemporium.com/">ROP Emproium</a> series.  
This is the approach taken to solve the 32 bit challenge step by step.  
If you would like extra information on Return Oriented Programming (ROP) visit the <a href="https://ropemporium.com/guide.html">ROP Emporium Guide</a>.  

### Challenge description
Sort the useful gadgets from the fluff to construct another write primitive in this challenge.  
You'll have to get creative though, the gadgets aren't straight forward.

# Solution 
The solution will be written in Go using the standard library only.  
Although <a href="https://github.com/Gallopsled/pwntools#readme">pwntools</a> is a quick and easy way to approach this problem, Go can compile
to a statically linked executable for most target systems.  
Since we already know the exploit path, we can focus on creating a ROP chain to obtain a system shell.  

### Assumptions
You have the following software installed:
- <a href="https://golang.org/">Golang</a>
- <a href="https://www.radare.org/">radare2</a>
- <a href="https://cutter.re/">Cutter</a>

# Technical

#### Inspect the binary
##### Check the properties:
<a href="/assets/img/2020-02-14-Fluff-x86/binary-info.png"><img src="/assets/img/2020-02-14-Fluff-x86/binary-info.png"></a>
We can see that the NX bit is set. This is the security feature we are defeating.
##### Identify sections:
<a href="/assets/img/2020-02-14-Fluff-x86/sections.png"><img src="/assets/img/2020-02-14-Fluff-x86/sections.png"></a>
The .data section at 0x0804a028 will be the target to write the string "/bin/sh" for later use.
##### Search for ROP gadgets
In the search field we select "ROP gadgets", search in "All maps" and press "Search".
<a href="/assets/img/2020-02-14-Fluff-x86/rop-search.png"><img src="/assets/img/2020-02-14-Fluff-x86/rop-search.png"></a>
Before we can write anything to memory, we need to identify the gadgets that will be best suited for the task.
<a href="/assets/img/2020-02-14-Fluff-x86/mov-edx-to-ecx-ptr.png"><img src="/assets/img/2020-02-14-Fluff-x86/mov-edx-to-ecx-ptr.png"></a>
Searching through all mov instructions, the following gadget at 0x08048693 moves the contents of the EDX register to the location ECX points to.
```x86asm
mov dword [ecx], edx
pop ebp
pop ebx
xor byte [ecx], bl
ret
```
With the above gadget, the following will load bytes into memory:
- Load the hexadecimal value of .data (0x0804a028) into the ECX register
- Load bytes, that we wish to write, into the EDX register
- Place padding values on the stack for the pop ebp; pop ebx; instructions

##### Writing strings to .data

#### Write the exploit
```go
package main

import (
    "log"
    "bufio"
    "os/exec"
    "fmt"
)

func main() {
}
```
